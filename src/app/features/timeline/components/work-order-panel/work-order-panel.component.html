<!-- Iruobe Work Order Panel -->

<div class="panel-backdrop" *ngIf="isOpen" (click)="onBackdropClick()"></div>

<aside class="work-order-panel" [class.open]="isOpen">

  <div class="panel-header">
    <div class="header-left">
      <h3 class="panel-title">Work Order Details</h3>
      <p class="panel-subtitle">Specify the dates, name and status for this order</p>
    </div>
    <div class="header-right">
      <button type="button" class="btn-cancel" (click)="onCancel()">Cancel</button>
      <button type="button" class="btn-create" (click)="onSubmit()">
        {{ mode === 'create' ? 'Create' : 'Save' }}
      </button>
    </div>
  </div>

  <div class="header-divider"></div>

  <div class="error-banner" *ngIf="errorMessage">
    <svg class="error-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
      <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.5"/>
      <path d="M8 4.5v4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
      <circle cx="8" cy="11" r="0.75" fill="currentColor"/>
    </svg>
    <span class="error-text">{{ errorMessage }}</span>
  </div>

  <form class="panel-content" [formGroup]="form" *ngIf="form" (ngSubmit)="onSubmit()">

    <!-- Work Order Name -->
    <div class="form-group">
      <label class="field-label" for="wo-name">Work Order Name</label>
      <input
        id="wo-name"
        class="field-input"
        type="text"
        formControlName="name"
        [class.field-error]="form.get('name')?.invalid && form.get('name')?.touched"
        [placeholder]="mode === 'create' ? 'Acme Inc.' : ''" />
      <span class="validation-hint"
        *ngIf="form.get('name')?.hasError('required') && form.get('name')?.touched">
        Work Order Name is required
      </span>
    </div>

    <!-- Status -->
    <div class="form-group">
      <label class="field-label">Status</label>
      <ng-select
        class="status-select"
        formControlName="status"
        [items]="statusOptions"
        bindLabel="label"
        bindValue="value"
        [clearable]="false"
        [searchable]="false"
        appendTo="body">
        <ng-template ng-label-tmp let-item="item">
          <span class="status-badge" [ngClass]="'badge-' + item.value">{{ item.label }}</span>
        </ng-template>
        <ng-template ng-option-tmp let-item="item">
          <span class="status-badge" [ngClass]="'badge-' + item.value">{{ item.label }}</span>
        </ng-template>
      </ng-select>
    </div>

    <!-- End date -->
    <div class="form-group date-field-group">
      <label class="field-label">End date</label>
      <input
        class="field-input date-input"
        [class.field-error]="form.get('endDate')?.invalid && form.get('endDate')?.touched"
        [class.has-value]="form.get('endDate')?.value"
        [value]="formatDate(form.get('endDate')?.value)"
        placeholder="01.01.2026"
        (click)="toggleEndPicker()"
        readonly />
      <div class="inline-datepicker-wrapper" *ngIf="endPickerOpen">
        <ngb-datepicker
          [navigation]="'select'"
          [showWeekNumbers]="true"
          [firstDayOfWeek]="1"
          [startDate]="endDateControl.value!"
          [formControl]="endDateControl"
          (dateSelect)="onEndDateSelect($event)">
        </ngb-datepicker>
      </div>
      <span class="validation-hint"
        *ngIf="form.get('endDate')?.hasError('required') && form.get('endDate')?.touched">
        End date is required
      </span>
      <span class="validation-hint"
        *ngIf="form.hasError('endBeforeStart') && form.get('endDate')?.touched">
        End date must be after start date
      </span>
    </div>

    <!-- Start date -->
    <div class="form-group date-field-group">
      <label class="field-label">Start date</label>
      <input
        class="field-input date-input"
        [class.field-error]="form.get('startDate')?.invalid && form.get('startDate')?.touched"
        [class.has-value]="form.get('startDate')?.value"
        [value]="formatDate(form.get('startDate')?.value)"
        placeholder="02.01.2026"
        (click)="toggleStartPicker()"
        readonly />
      <div class="inline-datepicker-wrapper" *ngIf="startPickerOpen">
        <ngb-datepicker
          [navigation]="'select'"
          [showWeekNumbers]="true"
          [firstDayOfWeek]="1"
          [startDate]="startDateControl.value!"
          [formControl]="startDateControl"
          (dateSelect)="onStartDateSelect($event)">
        </ngb-datepicker>
      </div>
      <span class="validation-hint"
        *ngIf="form.get('startDate')?.hasError('required') && form.get('startDate')?.touched">
        Start date is required
      </span>
    </div>

  </form>
</aside>